# Post-Inference Processing

This directory contains scripts for processing the raw output of the Code-Switching Inference model.

## `smooth_predictions.py`

This script takes the raw word-level CSV predictions from `inference_ALTO.py` and produces a smoothed, segment-level JSONL file.

### Usage

```bash
python smooth_predictions.py <path_to_input_csv> [--theta <min_segment_length>]
```

**Arguments:**
- `csv_path`: Path to the input CSV file generated by `inference_ALTO.py`.
- `--theta`: Minimum number of tokens required to form a valid segment. Default is 10.

**Output:**
- A `.jsonl` file in the same directory as the input CSV, with the extension replaced.
- Format: `{"type": "auto"|"allo", "text": "segment text..."}`

### Logic: Simple Threshold Merging

The smoothing algorithm uses a simple iterative merging strategy to eliminate short, unstable segments.

1.  **Identify Runs:**
    - The script scans the raw predictions to find contiguous runs of the same label.

2.  **Iterative Merging:**
    - It iteratively checks for any segment with length `< theta` (default 10).
    - **Merge Previous:** If a short segment follows another segment, it is merged into the **previous** segment (effectively cancelling the switch).
    - **Merge Next:** If the short segment is at the very beginning of the document, it is merged into the **next** segment.
    - This process repeats until all segments satisfy the minimum length requirement.
